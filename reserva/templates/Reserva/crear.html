{% extends "dashboard/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
	<!-- Page Heading -->
	<h1 class="h3 mb-2 text-gray-800">Reservas</h1>
	
	<div class='row'>
		<div class='col-sm-8 col-sm-offset-3'>
			<div class="card shadow mb-4">
			
				<div class="card-header py-3">
					<h6 class="m-0 font-weight-bold text-primary">Nueva Reserva</h6>
				</div>
				
				<div class="card-body">
		
					<form method="post" enctype="multipart/form-data"  id="reservaForm" data-hab-disp-url="{% url 'ajax_load_hab_disponible' %}" novalidate>
						{% csrf_token %}
					  
						{{ form|crispy }} 
					  
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-save"></i>
							Aceptar
						</button>
						
						<a href="./" type="submit" class="btn btn-primary">
							<i class="fas fa-caret-left"></i>
							Cancelar
						</a>
					 
					</form>
			
				</div>
			</div>
		</div>
	</div>
	
<script type="text/javascript">
	$(document).ready(function(){


		var habs;
	
		$("#id_id_habitacion_fk").change(function () {
			//var url = $("#reservaForm").attr("data-precio-url");	// get the url of the `load_cities` view
			//var habitacionId = $(this).val();	// get the selected country ID from the HTML input

			//$.ajax({							// initialize an AJAX request
				//url: url,						// set the url of the request (= localhost:8000/hr/ajax/load-cities/)
				//data: {
					//'habitacion': habitacionId	// add the country id to the GET parameters
				//},
				//success: function (data) {		// `data` is the return of the `load_cities` view function
					//$("#id_city").html(data);  // replace the contents of the city input with the data that came from the server
					//$("#id_costo_alojamiento").val(data)
				//}
			//});
			
			var i = $(this).find(":selected").index();
			$("#id_costo_alojamiento").val(habs[i-1].precio);

		});
		
		$("#id_fecha_salida").change(function () {
			var url = $("#reservaForm").attr("data-hab-disp-url"); 
			var fecha_entrada = $("#id_fecha_entrada").val();
			var fecha_salida = $(this).val();

			$.ajax({
				url: url,
				data: {
					'entrada': fecha_entrada,
					'salida': fecha_salida
				},
				success: function (data) {
					//$("#id_city").html(data);
					console.log(data);
					var dat = JSON.parse(data);
					habs = dat.habitaciones;
					console.log(habs);
					$("#id_id_habitacion_fk option").remove();
					$("#id_id_habitacion_fk").append('<option value selected>---------</option>');
					for (var i = 0; i < habs.length; i++) {
						console.log(habs[i].nro);
						$("#id_id_habitacion_fk").append('<option value="'+ habs[i].id +'">'+ habs[i].nro +'</option>');
					};
				}
			});

		});
		

	
	
	
		//function prueba() {
		//	console.log("Prueba exitosa");
		//	$("#id_costo_alojamiento").val("50000");
		//}






	});		
</script>
	
{% endblock %}
